"use strict";(self.webpackChunkapp_name=self.webpackChunkapp_name||[]).push([[776],{1776:(e,s,t)=>{t.r(s),t.d(s,{default:()=>x});var a=t(2791),d=t(7689),r=t(6862),i=t(8148),n=t(184);class l extends a.PureComponent{constructor(e){super(e),this.handleOrderSuccess=()=>{this.setState({orderSuccess:"/user/order/success/"})},this.initiatePayment=async()=>{this.setState({loader:!0});const{order_address_id:e}=this.props;try{const s=await r.axiosWithAuthentication.post("razorpay-payment-request/",{order_address_id:e});this.setState({amount:s.data.razor_order.amount});const t={key:"rzp_test_L8VApKZTzn8SO7",amount:s.data.razor_order.amount,currency:"INR",name:"E-Shop",description:"Payment for your product/service",order_id:s.data.razor_order.id,handler:t=>{const a={cart_payment:s.data.cart_payment,order_address_id:e&&e,razorpay_order_id:t.razorpay_order_id,razorpay_payment_id:t.razorpay_payment_id,razorpay_signature:t.razorpay_signature};r.axiosWithAuthentication.put("order-confirm/",a).then((e=>{this.context.handleCartCountAfterOrder(),this.handleOrderSuccess()})).catch((e=>{}))},prefill:{name:s.data.user.full_name,email:s.data.user.email,contact:""},theme:{color:"#3399cc"},modal:{ondismiss:async()=>{await r.axiosWithAuthentication.post("razorpay-payment-fail/",{payment_id:s.data.cart_payment.payment_id}).then((e=>{})).catch((e=>{}))}}};new window.Razorpay(t).open()}catch(s){console.error("Error initiating payment:",s),"stock_error"===s.response.data.message?this.props.out_of_stock_handle(!0):this.setState({razorOrderLimitError:s.response.data.message})}finally{this.setState({loader:!1})}},this.state={orderSuccess:null,loader:!1,razorOrderLimitError:""}}render(){return this.state.orderSuccess?(0,n.jsx)(d.Fg,{to:this.state.orderSuccess}):(0,n.jsx)(n.Fragment,{children:this.state.loader?(0,n.jsx)("div",{className:"w-50",children:(0,n.jsx)("div",{className:"payment-loader"})}):(0,n.jsx)("div",{className:"w-50",children:(0,n.jsx)("button",{className:"btn btn-primary w-100",onClick:this.initiatePayment,children:this.state.razorOrderLimitError?this.state.razorOrderLimitError:"Pay Now"})})})}}l.contextType=i.A;const o=l;var c=t(9548),h=t(8182);const m=["Andhra Pradesh","Arunachal Pradesh","Assam","Bihar","Chhattisgarh","Goa","Gujarat","Haryana","Himachal Pradesh","Jharkhand","Karnataka","Kerala","Madhya Pradesh","Maharashtra","Manipur","Meghalaya","Mizoram","Nagaland","Odisha","Punjab","Rajasthan","Sikkim","Tamil Nadu","Telangana","Tripura","Uttar Pradesh","Uttarakhand","West Bengal"],u={id:null,full_name:"",mobile:"",pincode:"",locality:"",address:"",city_district_town:"",state:"",landmark:""};class p extends a.PureComponent{constructor(e){super(e),this.selectedAddressClose=()=>{let e=this.state.orderData;e.selectedOrderAddressId=null,this.setState({...this.state.orderData,orderData:e})},this.handlefetchCart=()=>{(0,h.x7)().then((e=>{this.setState({cartItems:e.data})}))},this.updateAddress=e=>{let s=this.state.orderAddress.find((s=>s.id===e)),t=this.state.address;t=s,this.setState({...this.state.address,address:t})},this.showHideAddAddress=(e,s)=>{switch(e){case"add":this.setState({addAddressForm:!0,updateAddressBtn:!1}),this.setState({updatingAddress:null}),this.selectedAddressClose();break;case"close":this.state.address.full_name&&this.resetState(),this.setState({addAddressForm:!1});break;case"update":this.setState({addAddressForm:!0,updateAddressBtn:!0}),this.updateAddress(s);break;default:return}},this.onChangeAddressAdd=e=>{const{name:s,value:t}=e.target;let a=this.state.address;a[s]=t,this.setState({...this.state.address,address:a})},this.addressSubmit=e=>{if(this.state.addressSubmiting){this.setState({addressSubmiting:!1});const{full_name:s,mobile:t,city_district_town:a,locality:d,landmark:i,pincode:n,state:l,address:o,id:c}=this.state.address,h={full_name:s,mobile:t,pincode:n,locality:d,address:o,city_district_town:a,state:l,landmark:i,user:this.props.userProfile.id};switch(e){case"create":r.axiosWithAuthentication.post("order-address/",h).then((e=>{this.setState({addAddressForm:!1}),this.resetState(),this.fetchOrderAddress()})).catch((e=>{})),this.setState({addressSubmiting:!0});break;case"update":r.axiosWithAuthentication.put("order-address/".concat(c,"/"),h).then((e=>{this.setState({addAddressForm:!1}),this.setState({updateAddressBtn:!1}),this.resetState(),this.fetchOrderAddress()})).catch((e=>{})),this.setState({addressSubmiting:!0});break;case"delete":r.axiosWithAuthentication.delete("order-address/".concat(c,"/")).then((e=>{this.setState({addAddressForm:!1}),this.setState({updateAddressBtn:!1}),this.resetState(),this.fetchOrderAddress()})).catch((e=>{})),this.setState({addressSubmiting:!0});break;default:return}}},this.orderAddressIdSave=e=>{let s=this.state.orderData;s.selectedOrderAddressId=e,this.setState({...this.state.orderData,orderData:s})},this.outOfStockHandle=e=>{e&&this.setState({outOfStock:!0})},this.paymentMethodSelectionHandle=e=>{let s=this.state.orderData;s.selectedPaymentMethod=e,this.setState({...this.state.orderData,payment:s})},this.cashOnDeliveryHandle=()=>{const e={order_address_id:this.state.orderData.selectedOrderAddressId};r.axiosWithAuthentication.post("order/cash-on-delivery/",e).then((e=>{console.log(e),this.context.handleCartCountAfterOrder(),this.setState({orderSuccess:"/user/order/success/"})})).catch((e=>{}))},this.state={orderAddress:null,updatingAddress:null,addAddressForm:!1,updateAddressBtn:!1,addressSubmiting:!0,cartItems:null,cartChecked:!1,outOfStock:!1,amount:null,discount:null,totalAmount:null,address:{...u},orderData:{selectedOrderAddressId:null,selectedPaymentMethod:null},orderSuccess:null}}componentDidMount(){window.scrollTo(0,0),this.fetchOrderAddress(),this.handlefetchCart()}componentDidUpdate(e,s){s.cart===this.state.cart&&this.orderDetailsCalculation()}resetState(){let e=this.state.address;e={...u},this.setState({...this.state.address,address:e}),this.selectedAddressClose()}fetchOrderAddress(){r.axiosWithAuthentication.get("order-address/").then((e=>{this.setState({orderAddress:e.data})})).catch((e=>{}))}orderDetailsCalculation(){let e=0,s=0,t=0;this.state.cartItems&&this.state.cartItems.forEach((t=>{t.product_variant.stock<t.quantity&&this.setState({outOfStock:!0}),s+=t.product_variant.price/100*t.product_variant.offer*t.quantity,e+=t.quantity*t.product_variant.price})),t=e-s+50,this.setState({amount:e}),this.setState({discount:s}),this.setState({totalAmount:t})}render(){const{orderAddress:e,addAddressForm:s,updateAddressBtn:t,address:a,cartItems:r,amount:i,discount:l,totalAmount:c,orderData:h,outOfStock:u,orderSuccess:p}=this.state;return p?(0,n.jsx)(d.Fg,{to:p}):r&&r.length<1?(0,n.jsx)(d.Fg,{to:"/"}):(0,n.jsx)(n.Fragment,{children:r&&(0,n.jsxs)("div",{className:"checkout-main-container",children:[(0,n.jsxs)("div",{className:"order-address-container",children:[(0,n.jsxs)("div",{className:"select-address",children:[(0,n.jsx)("h4",{className:"bg-primary text-light ps-4 py-2 mb-3",children:"Select Address"}),!s&&e&&e.map((e=>(0,n.jsxs)("div",{className:"each-address mb-2",children:[(0,n.jsx)("input",{onClick:()=>this.orderAddressIdSave(e.id),type:"radio",name:"order-address"}),(0,n.jsxs)("div",{className:"address",children:[(0,n.jsx)("div",{children:"\n                                                ".concat(e.full_name,", ").concat(e.mobile,"                                                  \n                                            ")}),"\n                                                ".concat(e.address,"\n                                                ")]}),(0,n.jsx)("span",{onClick:()=>this.showHideAddAddress("update",e.id),className:"address-edit-btn",children:"Edit"})]},e.id)))]}),!s&&(0,n.jsx)("div",{className:"create-update-new-address btn btn-sm btn-success mt-2",onClick:()=>this.showHideAddAddress("add"),children:"Add new address"}),s&&(0,n.jsx)("div",{className:"row mt-3",children:(0,n.jsx)("div",{className:" mb-4",children:(0,n.jsxs)("div",{className:"card mb-4",children:[(0,n.jsx)("div",{className:"card-header py-2",children:(0,n.jsx)("h5",{className:"mb-0",children:"Add new address"})}),(0,n.jsx)("div",{className:"card-body",children:(0,n.jsxs)("form",{children:[(0,n.jsx)("div",{className:"row mb-3",children:(0,n.jsx)("div",{className:"col",children:(0,n.jsxs)("div",{className:"form-outline",children:[(0,n.jsx)("input",{onChange:this.onChangeAddressAdd,value:a.full_name,name:"full_name",type:"text",id:"form7Example1",className:"form-control form-control-sm"}),(0,n.jsx)("label",{className:"form-label",for:"form7Example1",children:"Full name"})]})})}),(0,n.jsxs)("div",{className:"row",children:[(0,n.jsx)("div",{className:"col",children:(0,n.jsxs)("div",{className:"form-outline mb-3",children:[(0,n.jsx)("input",{onChange:this.onChangeAddressAdd,value:a.mobile,name:"mobile",type:"number",id:"form7Example6",className:"form-control form-control-sm"}),(0,n.jsx)("label",{className:"form-label",for:"form7Example6",children:"Phone"})]})}),(0,n.jsx)("div",{className:"col",children:(0,n.jsxs)("div",{className:"form-outline mb-3",children:[(0,n.jsx)("input",{onChange:this.onChangeAddressAdd,value:a.city_district_town,name:"city_district_town",type:"text",id:"form7Example4",className:"form-control form-control-sm"}),(0,n.jsx)("label",{className:"form-label",for:"form7Example4",children:"City/ District/ Town"})]})})]}),(0,n.jsxs)("div",{className:"row",children:[(0,n.jsx)("div",{className:"col",children:(0,n.jsxs)("div",{className:"form-outline mb-3",children:[(0,n.jsx)("input",{onChange:this.onChangeAddressAdd,value:a.locality,name:"locality",type:"text",id:"form7Example3",className:"form-control form-control-sm"}),(0,n.jsx)("label",{className:"form-label",for:"form7Example3",children:"Locality "})]})}),(0,n.jsx)("div",{className:"col",children:(0,n.jsxs)("div",{className:"form-outline mb-3",children:[(0,n.jsx)("input",{onChange:this.onChangeAddressAdd,value:a.landmark,name:"landmark",type:"text",id:"form7Example5",className:"form-control form-control-sm"}),(0,n.jsx)("label",{className:"form-label",for:"form7Example5",children:"Landmark"})]})})]}),(0,n.jsxs)("div",{className:"row",children:[(0,n.jsx)("div",{className:"col",children:(0,n.jsxs)("div",{className:"form-outline mb-3",children:[(0,n.jsx)("input",{onChange:this.onChangeAddressAdd,value:a.pincode,name:"pincode",type:"number",id:"form7Example5",className:"form-control form-control-sm"}),(0,n.jsx)("label",{className:"form-label",for:"form7Example5",children:"PIN"})]})}),(0,n.jsx)("div",{className:"col",children:(0,n.jsxs)("div",{className:"form-outline mb-3",children:[(0,n.jsxs)("select",{id:"form7Example5",class:"form-select",onChange:this.onChangeAddressAdd,name:"state","aria-label":"Default select example",children:[(0,n.jsx)("option",{value:"0",selected:!0,children:"Select state"}),m.map((e=>(0,n.jsx)("option",{value:e,children:e})))]}),(0,n.jsx)("label",{className:"form-label",for:"form7Example5",children:"State"})]})})]}),(0,n.jsxs)("div",{className:"form-outline mb-3",children:[(0,n.jsx)("textarea",{onChange:this.onChangeAddressAdd,value:a.address,name:"address",className:"form-control form-control-sm",id:"form7Example7",rows:"4"}),(0,n.jsx)("label",{className:"form-label",for:"form7Example7",children:"Address"})]}),t?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("span",{onClick:()=>this.addressSubmit("update"),className:"btn btn-sm btn-success",children:"Update Address"}),e.length>1&&(0,n.jsx)("span",{onClick:()=>this.addressSubmit("delete"),className:"btn btn-sm btn-danger float-end",children:"Delete Address"})]}):(0,n.jsx)("span",{onClick:()=>this.addressSubmit("create"),className:"btn btn-sm btn-success",children:"Save Address"})]})})]})})}),s&&(0,n.jsx)("div",{className:"create-update-new-address btn btn-sm btn-dark mt-2",onClick:()=>this.showHideAddAddress("close"),children:"Close"}),(0,n.jsx)("h4",{className:"bg-primary text-light ps-4 py-2 mb-3 mt-4",children:"Payment method"}),!u&&h.selectedOrderAddressId&&(0,n.jsxs)("div",{className:"payment-method-container",children:[(0,n.jsxs)("div",{className:"payment-container",children:[(0,n.jsx)("input",{type:"radio",name:"payment-method",onClick:()=>this.paymentMethodSelectionHandle("razorpay")}),(0,n.jsx)("div",{className:"payment",children:(0,n.jsx)("div",{children:"Razorpay Card/Net-Banking"})}),"razorpay"===h.selectedPaymentMethod&&(0,n.jsx)(o,{cart_items:r,order_address_id:h.selectedOrderAddressId,out_of_stock_handle:this.outOfStockHandle})]}),(0,n.jsxs)("div",{className:"payment-container",children:[(0,n.jsx)("input",{type:"radio",name:"payment-method",onClick:()=>this.paymentMethodSelectionHandle("cash-on-delivery")}),(0,n.jsx)("div",{className:"payment",children:(0,n.jsx)("div",{children:"Cash on delivery"})}),"cash-on-delivery"===h.selectedPaymentMethod&&(0,n.jsx)("button",{className:"btn btn-primary w-50",onClick:this.cashOnDeliveryHandle,children:"Place order"})]})]})]}),(0,n.jsxs)("div",{className:"order-details",children:[(0,n.jsx)("h5",{children:"Order details"}),u?(0,n.jsx)("div",{className:"item-details",children:"Some items out of stock check cart"}):(0,n.jsxs)("div",{className:"item-details",children:[(0,n.jsxs)("div",{className:"amount-container",children:[(0,n.jsxs)("div",{className:"amount-title",children:["Amount (",r&&r.length>1?r.length+" items":"1 item",")"]}),(0,n.jsxs)("div",{className:"amount",children:["Rs.",i&&i]})]}),(0,n.jsxs)("div",{className:"discount-container",children:[(0,n.jsx)("div",{className:"discount-title",children:"Discount"}),(0,n.jsxs)("div",{className:"discount",children:["-Rs.",l&&l]})]}),(0,n.jsxs)("div",{className:"delivery-charge-container",children:[(0,n.jsx)("div",{className:"title",children:"Delivery Charge"}),(0,n.jsx)("div",{className:"delivery-amount",children:"50"})]}),(0,n.jsx)("hr",{}),(0,n.jsxs)("div",{className:"total-amount-container",children:[(0,n.jsx)("h6",{className:"title",children:"Total amount"}),(0,n.jsxs)("h6",{className:"total-amount",children:["Rs.",c&&c]})]}),(0,n.jsx)("hr",{})]})]})]})})}}p.contextType=i.A;const x=(0,c.Z)(p)},9548:(e,s,t)=>{t.d(s,{Z:()=>r});var a=t(7689),d=t(184);const r=e=>s=>localStorage.getItem("accessToken")?(0,d.jsx)(e,{...s}):(0,d.jsx)(a.Fg,{to:"/"})}}]);
//# sourceMappingURL=776.b24bf438.chunk.js.map